# Docker Setup - Prueba Técnica

Este documento contiene las instrucciones para configurar y ejecutar los servicios de base de datos usando Docker Compose.

## Servicios Incluidos

- **Oracle Database 21c Express Edition**: Puerto 1521
- **MongoDB 6**: Puerto 27017

## Comandos de Configuración

### 1. Iniciar los servicios

```bash
# Iniciar todos los servicios (usar 'docker compose' sin guión)
docker compose up -d

# Ver logs de los servicios
docker compose logs -f

# Ver estado de los servicios
docker compose ps
```

### 2. Verificar conectividad Oracle

```bash
# Esperar a que Oracle esté completamente iniciado (puede tomar 2-3 minutos)
docker compose logs oracle

# Verificar que el healthcheck esté OK
docker inspect oracle --format='{{.State.Health.Status}}'
```

### 3. Ejecutar scripts de inicialización Oracle

```bash
# Conectar a Oracle y ejecutar scripts manualmente
docker exec -it oracle sqlplus system/oracle123@//localhost:1521/XEPDB1

# O ejecutar script directamente
docker exec -i oracle sqlplus system/oracle123@//localhost:1521/XEPDB1 < scripts/oracle/01-create-tables.sql
```

### 4. Comandos SQL para Oracle (ejecución manual)

Si necesitas ejecutar los comandos manualmente en sqlplus:

```sql
-- Conectar a la base de datos pluggable
ALTER SESSION SET CONTAINER = XEPDB1;

-- Crear tabla CLIENTES
CREATE TABLE CLIENTES (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE VARCHAR2(200) NOT NULL,
    IDENTIFICACION VARCHAR2(50) NOT NULL UNIQUE,
    CORREO VARCHAR2(100) NOT NULL,
    DIRECCION VARCHAR2(300),
    FECHA_CREACION TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ACTIVO NUMBER(1) DEFAULT 1 CHECK (ACTIVO IN (0,1))
);

-- Crear índice en IDENTIFICACION
CREATE INDEX IDX_CLIENTES_IDENTIFICACION ON CLIENTES(IDENTIFICACION);

-- Crear tabla FACTURAS
CREATE TABLE FACTURAS (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENTE_ID NUMBER NOT NULL,
    FECHA_EMISION TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    MONTO_TOTAL NUMBER(10,2) NOT NULL CHECK (MONTO_TOTAL > 0),
    ESTADO VARCHAR2(20) DEFAULT 'PENDIENTE',
    CONSTRAINT FK_FACTURAS_CLIENTE FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTES(ID)
);

-- Crear índices en FACTURAS
CREATE INDEX IDX_FACTURAS_FECHA_EMISION ON FACTURAS(FECHA_EMISION);
CREATE INDEX IDX_FACTURAS_CLIENTE_ID ON FACTURAS(CLIENTE_ID);

-- Confirmar cambios
COMMIT;
```

### 5. Verificar MongoDB

```bash
# Conectar a MongoDB
docker exec -it mongodb mongosh -u admin -p admin123

# En mongosh, verificar la base de datos
use prueba_tecnica
show collections
db.audit_logs.find().pretty()
```

### 6. Comandos útiles

```bash
# Detener servicios
docker compose down

# Detener y eliminar volúmenes (CUIDADO: elimina todos los datos)
docker compose down -v

# Reiniciar un servicio específico
docker compose restart oracle
docker compose restart mongodb

# Ver logs de un servicio específico
docker compose logs -f oracle
docker compose logs -f mongodb
```

## Credenciales

### Oracle Database
- **Usuario**: system
- **Password**: oracle123
- **SID**: XE
- **PDB**: XEPDB1
- **Puerto**: 1521

### MongoDB
- **Usuario**: admin
- **Password**: admin123
- **Puerto**: 27017

## Estructura de Archivos

```
prueba-tecnica/
├── docker-compose.yml
├── scripts/
│   ├── oracle/
│   │   └── 01-create-tables.sql
│   └── mongo/
│       └── 01-init-mongo.js
└── DOCKER_SETUP.md
```

## Troubleshooting

### Oracle no inicia
- Verificar que tienes suficiente memoria (mínimo 2GB)
- Esperar más tiempo (Oracle XE puede tomar hasta 5 minutos en iniciar)
- Revisar logs: `docker compose logs oracle`

### Error de conexión Oracle
- Verificar que el puerto 1521 no esté en uso
- Usar la conexión completa: `system/oracle123@//localhost:1521/XEPDB1`

### MongoDB no inicia
- Verificar que el puerto 27017 no esté en uso
- Revisar logs: `docker compose logs mongodb`
